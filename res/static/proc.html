<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ULC</title>
<link
	href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
	rel="stylesheet">
<link href="css/ulc.css" rel="stylesheet">

<script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<body>
	<!--导航-->
	<div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
		<div class="container">
			<div class="navbar-header nav-title ">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand " href="index.html">ULC</a>
			</div>
			<div class="collapse navbar-collapse navbar-right is-collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="./hosts.html">进程管理</a></li>
					<li><a href="./index.html">日志搜索</a></li>
					<li><a href="./proc.html">进程搜索</a></li>
					<li><a href="./info.html">Info</a></li>
					<li><a href="./pv.html">PV</a></li>
				</ul>
			</div>
			<!-- /.nav-collapse -->
		</div>
		<!-- /.container -->
	</div>
	<!--导航-->
	<div class="container-fluid" style="margin-top: 50px">
		<div class="panel panel-success">
			<div class="panel-heading">
				<input placeholder="proc" id="proc">
				<button id="search">Search</button>
			</div>
			<div class="panel-body">
				<div id="result" class="table-responsive"></div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$('#search').click(doSearch);

	function doSearch() {
		var p = $('#proc').val();
		if (!p) {
			return alert('input proc');
		}

		$.get('./proc/search?proc=' + p, function(data) {
			var html = '<table class="table table-hover table-bordered">';
			for ( var i in data) {
				var item = data[i];
				var proc = item.proc;
				var host = item.host;
				var start = proc.lastIndexOf('/') + 1;
				var info = proc.substr(start);
				var show_name = info + "(" + host + ")";
				html += '<tr><td>' + createBtn(host, proc) + '</td><td>'
						+ show_name + '</td></tr>';
			}
			html += '</table>';
			$('#result').html(html);
		});
	}

	function createBtn(host, path) {
		return "<button onclick=restartProc('" + host + "','" + path
				+ "')>Restart</button>";
	}

	function restartProc(host, path) {
		var a = confirm("确认重启吗?");
		if (a == false)
			return;
		var btn = $(event.target);
		btn.text('waiting....');
		btn.attr({
			"disabled" : "disabled"
		});
		$.get('./proc/restart?host=' + host + '&path=' + path, function(data) {
			alert(data.join('\n'));
			btn.text('Restart');
			btn.removeAttr("disabled");
		});
	}
</script>
</body>