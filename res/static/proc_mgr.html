<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ULC</title>
<link
	href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
	rel="stylesheet">
<link href="css/ulc.css" rel="stylesheet">

<script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="js/ulc.js"></script>
<body>
	<!--导航-->
	<div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
		<div class="container">
			<div class="navbar-header nav-title ">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand " href="index.html">ULC</a>
			</div>
			<div class="collapse navbar-collapse navbar-right is-collapse">
				<ul class="nav navbar-nav" id="menuId"></ul>
			</div>
			<!-- /.nav-collapse -->
		</div>
		<!-- /.container -->
	</div>
	<!--导航-->
	<div class="container-fluid" style="margin-top: 50px">
		<div class="panel panel-success">
			<div class="panel-heading">
				host <select id="hostId"></select>name<input id='name' size=10
					onkeydown="updatePath()" onchange="updatePath()" type="text"> path<input id='path'
					value='/var/www/data/work/' size=35 type="text"> shell<input
					id='shell' type="text" value="service.sh" size=8>
				<button onclick="addProc()">Add</button>
				<button onclick="search()">Select</button>
			</div>
			<div class="panel-body">
				<div id="list" class="table-responsive">
					<table class="table table-striped">
						<caption>进程列表</caption>
						<thead>
							<tr>
								<th>name</th>
								<th>host</th>
								<th>path</th>
								<th>shell</th>
								<th>stop</th>
								<th>start</th>
								<th>restart</th>
								<th>remove</th>
							</tr>
						</thead>
						<tbody id="record">
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var bathPath = "/var/www/data/work/";

	function tr(val) {
		return '<td>' + val + '</td>';
	}

	function remove(id) {
		alert('not support');
	}

	function updatePath() {
		$('#path').val(bathPath + $('#name').val());
	}

	function manage(type, id) {
		var arg = {
			"type" : type,
			"id" : id,
		};
		$.get('./proc/mgr', arg, function(data) {
			alert(data.join('\n'));
		});
	}

	function buildTable(data) {
		var html = '';
		for ( var i in data) {
			var proc = data[i];
			var id = proc.id;
			var name = proc.name;
			var path = proc.path;
			var shell = proc.shell;
			var host = mapHostIdToName(proc.hostId);
			var del = buildBtn('remove', 'Remove', [ id ]);
			var stop = buildBtn('manage', 'Stop', [ 'stop', id ]);
			var start = buildBtn('manage', 'Start', [ 'start', id ]);
			var restart = buildBtn('manage', 'Restart', [ 'restart', id ]);

			html += "<tr>" + tr(name) + tr(host) + tr(path) + tr(shell)
					+ tr(stop) + tr(start) + tr(restart) + tr(del) + "</tr>";
		}
		$('#record').html(html);
	}

	function loadProcs() {
		$.get('./proc/list', buildTable);
	}

	function getParam() {
		return {
			"name" : $('#name').val().trim(),
			"path" : $('#path').val().trim(),
			"shell" : $('#shell').val().trim(),
			"hostId" : $('#hostId').val().trim(),
		};
	}

	function search() {
		var param = getParam();
		$.get('./proc/list', param, buildTable);
	}

	function addProc() {
		var param = getParam();
		if (!param.name)
			return alert('name is empty');
		if (!param.path)
			return alert('path is empty');
		if (!param.hostId)
			return alert('host is empty');
		if (!param.shell)
			return alert('shell is empty');

		$.get('./proc/add', param, function(d) {
			alert(d.error ? d.info : 'success');
			if (!d.error)
				location.reload();
		});
	}

	$(function() {
		bindMenus('#menuId');
		asynLoadHost('#hostId', loadProcs);
	});
</script>
</body>